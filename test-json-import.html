<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Import Teszt</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .upload-area {
      border: 3px dashed #4CAF50;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      background: #f9fff9;
      cursor: pointer;
      transition: all 0.3s;
    }
    .upload-area:hover {
      background: #f0fff0;
      border-color: #45a049;
    }
    .upload-area.dragover {
      background: #e8ffe8;
      border-color: #2e7d32;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      background: #000;
      color: #0f0;
      padding: 20px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
      font-size: 13px;
      line-height: 1.5;
    }
    .log-entry {
      margin: 5px 0;
    }
    .log-success { color: #0f0; }
    .log-error { color: #f00; }
    .log-warning { color: #ff0; }
    .log-info { color: #0ff; }
    .preview {
      margin-top: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    .exercise-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      margin: 10px 0;
    }
    .exercise-image {
      max-width: 200px;
      max-height: 200px;
      border-radius: 5px;
      margin-top: 10px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÅ JSON Import Teszt</h1>
    <p class="subtitle">Teszteld a JSON f√°jl bet√∂lt√©st √©s valid√°ci√≥t</p>

    <!-- Upload Area -->
    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
      <div style="font-size: 48px; margin-bottom: 10px;">üì§</div>
      <h3>Kattints vagy h√∫zd ide a JSON f√°jlt</h3>
      <p style="color: #666; margin-top: 10px;">
        T√°mogatott form√°tum: session_*.json
      </p>
    </div>
    <input type="file" id="fileInput" accept=".json" />

    <!-- Stats -->
    <div class="stats" id="stats" style="display: none;">
      <div class="stat-card">
        <div class="stat-label">Munkamenet K√≥d</div>
        <div class="stat-value" id="statCode">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Feladatok Sz√°ma</div>
        <div class="stat-value" id="statExercises">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Teljes M√©ret</div>
        <div class="stat-value" id="statSize">0 KB</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">K√©pek M√©rete</div>
        <div class="stat-value" id="statImages">0 KB</div>
      </div>
    </div>

    <!-- Preview -->
    <div class="preview" id="preview" style="display: none;">
      <h3>üìã Feladatok El≈ën√©zete</h3>
      <div id="exerciseList"></div>
    </div>

    <!-- Log -->
    <div class="log" id="log"></div>

    <!-- Actions -->
    <div style="text-align: center; margin-top: 20px;">
      <button onclick="clearLog()">üóëÔ∏è Log T√∂rl√©se</button>
      <button onclick="location.reload()">üîÑ √öjrakezd√©s</button>
    </div>
  </div>

  <script>
    let loadedData = null;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const className = `log-${type}`;
      logDiv.innerHTML += `<div class="log-entry ${className}">[${timestamp}] ${message}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    function processJSON(file) {
      log(`üìÅ F√°jl kiv√°lasztva: ${file.name} (${formatBytes(file.size)})`, 'info');
      
      const reader = new FileReader();
      
      reader.onload = (e) => {
        try {
          const content = e.target.result;
          const data = JSON.parse(content);
          
          log('‚úÖ JSON sikeresen parse-olva', 'success');
          
          // Validate structure
          if (!data.exercises || !Array.isArray(data.exercises)) {
            log('‚ùå Hib√°s form√°tum: hi√°nyzik az "exercises" t√∂mb', 'error');
            return;
          }
          
          log(`üìä Feladatok sz√°ma: ${data.exercises.length}`, 'success');
          
          // Validate exercises
          let validCount = 0;
          let totalImageSize = 0;
          
          data.exercises.forEach((ex, index) => {
            const hasId = !!ex.id;
            const hasType = !!ex.type;
            const hasTitle = !!ex.title;
            const hasContent = !!ex.content;
            const hasImage = !!ex.imageUrl;
            
            if (hasId && hasType && hasTitle && hasContent) {
              validCount++;
              log(`‚úÖ Feladat ${index + 1}: ${ex.title} (${ex.type})`, 'success');
              
              if (hasImage) {
                const imageSize = ex.imageUrl.length;
                totalImageSize += imageSize;
                log(`   üñºÔ∏è K√©p: ${formatBytes(imageSize)}`, 'info');
              } else {
                log(`   ‚ö†Ô∏è Nincs k√©p`, 'warning');
              }
            } else {
              log(`‚ùå Feladat ${index + 1}: Hi√°nyos adatok`, 'error');
              log(`   - ID: ${hasId ? '‚úÖ' : '‚ùå'}`, hasId ? 'success' : 'error');
              log(`   - Type: ${hasType ? '‚úÖ' : '‚ùå'}`, hasType ? 'success' : 'error');
              log(`   - Title: ${hasTitle ? '‚úÖ' : '‚ùå'}`, hasTitle ? 'success' : 'error');
              log(`   - Content: ${hasContent ? '‚úÖ' : '‚ùå'}`, hasContent ? 'success' : 'error');
            }
          });
          
          log(`üìä √ârv√©nyes feladatok: ${validCount} / ${data.exercises.length}`, validCount === data.exercises.length ? 'success' : 'warning');
          log(`üìä K√©pek teljes m√©rete: ${formatBytes(totalImageSize)}`, 'info');
          log(`üìä JSON teljes m√©rete: ${formatBytes(file.size)}`, 'info');
          
          // Update stats
          document.getElementById('stats').style.display = 'grid';
          document.getElementById('statCode').textContent = data.code || 'N/A';
          document.getElementById('statExercises').textContent = validCount;
          document.getElementById('statSize').textContent = formatBytes(file.size).split(' ')[0];
          document.getElementById('statImages').textContent = formatBytes(totalImageSize).split(' ')[0];
          
          // Show preview
          showPreview(data);
          
          loadedData = data;
          log('üéâ JSON bet√∂lt√©s sikeres!', 'success');
          
        } catch (error) {
          log(`‚ùå JSON parse hiba: ${error.message}`, 'error');
          console.error(error);
        }
      };
      
      reader.onerror = () => {
        log('‚ùå F√°jl olvas√°si hiba', 'error');
      };
      
      reader.readAsText(file);
    }

    function showPreview(data) {
      const previewDiv = document.getElementById('preview');
      const listDiv = document.getElementById('exerciseList');
      
      previewDiv.style.display = 'block';
      listDiv.innerHTML = '';
      
      data.exercises.forEach((ex, index) => {
        const card = document.createElement('div');
        card.className = 'exercise-card';
        
        let imageHTML = '';
        if (ex.imageUrl) {
          imageHTML = `<img src="${ex.imageUrl}" class="exercise-image" alt="Exercise ${index + 1}" />`;
        }
        
        card.innerHTML = `
          <h4>${index + 1}. ${ex.title}</h4>
          <p><strong>T√≠pus:</strong> ${ex.type}</p>
          <p><strong>Utas√≠t√°s:</strong> ${ex.instruction || 'Nincs'}</p>
          <p><strong>K√©p:</strong> ${ex.imageUrl ? `‚úÖ ${formatBytes(ex.imageUrl.length)}` : '‚ùå Nincs'}</p>
          ${imageHTML}
        `;
        
        listDiv.appendChild(card);
      });
    }

    // File input handler
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        processJSON(file);
      }
    });

    // Drag and drop
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.json')) {
        processJSON(file);
      } else {
        log('‚ùå Csak JSON f√°jlokat lehet bet√∂lteni', 'error');
      }
    });

    // Initial log
    log('üöÄ JSON Import Teszt Tool elind√≠tva', 'success');
    log('üìù V√°lassz ki egy session_*.json f√°jlt a tesztel√©shez', 'info');
  </script>
</body>
</html>
